{% extends 'base.html' %}

{% block content %}
<div class="container">
  <h1>Distributed Caching Application</h1>

  <div class="row">
    <div class="col-md-6">
      <canvas id="nodes-chart"></canvas>
    </div>

    <div class="col-md-6">
      <h2>Memcache Pool Statistics</h2>
      <canvas id="miss-rate-chart"></canvas>
      <canvas id="hit-rate-chart"></canvas>
      <canvas id="items-chart"></canvas>
      <canvas id="size-chart"></canvas>
      <canvas id="requests-chart"></canvas>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Parse the data from the Flask route
  var active_nodes_data = {{ active_nodes_data|safe }};
  var active_nodes_labels = {{ active_nodes_labels|safe }};
  {#var miss_rate_data = {{ miss_rate_data|safe }};#}
  {#var hit_rate_data = {{ hit_rate_data|safe }};#}
  {#var num_items_data = {{ num_items_data|safe }};#}
  {#var size_items_data = {{ size_items_data|safe }};#}
  {#var num_requests_data = {{ num_requests_data|safe }};#}


// Helper function to generate a random color
function getRandomColor() {
  var letters = '0123456789ABCDEF';
  var color = '#';
  for (var i = 0; i < 6; i++) {
    color += letters[Math.floor(Math.random() * 16)];
  }
  return color;
}

// Generate an array of random background colors for the active nodes
var backgroundColors = [];
for (var i = 0; i < numActiveNodes; i++) {
  backgroundColors.push(getRandomColor());
}

  // Create the circular chart for active nodes
  var nodesChart = new Chart('nodes-chart', {
    type: 'doughnut',
    data: {
      datasets: [{
        data: active_nodes_data,
        backgroundColor: backgroundColors
      }],
      labels: active_nodes_labels
    }
  });

  {#// Create the line chart for miss rate#}
  {#var missRateChart = new Chart('miss-rate-chart', {#}
  {#  type: 'line',#}
  {#  data: {#}
  {#    labels: Array.from(Array(miss_rate_data.length), (_, i) => (i+1).toString()),#}
  {#    datasets: [{#}
  {#      label: 'Miss Rate',#}
  {#      data: miss_rate_data,#}
  {#      backgroundColor: '#36A2EB'#}
  {#    }]#}
  {#  }#}
  {#});#}
  {##}
  {#// Create the line chart for hit rate#}
  {#var hitRateChart = new Chart('hit-rate-chart', {#}
  {#  type: 'line',#}
  {#  data: {#}
  {#    labels: Array.from(Array(hit_rate_data.length), (_, i) => (i+1).toString()),#}
  {#    datasets: [{#}
  {#      label: 'Hit Rate',#}
  {#      data: hit_rate_data,#}
  {#      backgroundColor: '#FF6384'#}
  {#    }]#}
  {#  }#}
  {#});#}
  {##}
  {#// Create the line chart for number of items in cache#}
  {#var itemsChart = new Chart('items-chart', {#}
  {#  type: 'line',#}
  {#  data: {#}
  {#    labels: Array.from(Array(num_items_data.length), (_, i) => (i+1).toString()),#}
  {#    datasets: [{#}
  {#      label: 'Number of Items in Cache',#}
  {#      data: num_items_data,#}
  {#      backgroundColor: '#4BC0C0'#}
  {#    }]#}
  {#  }#}
  {#});#}
  {##}
  {#// Create the line chart for total size of items in cache#}
  {#var sizeChart = new Chart('size-chart', {#}
  {#  type: 'line',#}
  {#  data: {#}
  {#    labels: Array.from(Array(size_items_data.length), (_, i) => (i+1).toString()),#}
  {#    datasets: [{#}
  {#      label: 'Total Size of Items in Cache',#}
  {#      data: size_items_data,#}
  {#      backgroundColor: '#FFCE56'#}
  {#    }]#}
  {#  }#}
  {#});#}
  {##}
  {#// Create the line chart for number of requests served per minute#}
  {#  var requestsChart = new Chart('requests-chart', {#}
  {#      type: 'line',#}
  {#      data: {#}
  {#      labels: Array.from(Array(num_requests_data.length), (_, i) => (i+1).toString()),#}
  {#      datasets: [{#}
  {#          label: 'Number of Requests Served per Minute',#}
  {#          data: num_requests_data,#}
  {#          backgroundColor: '#2962ff'#}
  {#      }]#}
  {#      }#}
  {#  });#}

</script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"></script>
    <div>
        <canvas id="lineChart1" width="900" height="400"></canvas>
        <canvas id="lineChart4" width="900" height="400"></canvas>
        <canvas id="lineChart2" width="900" height="400"></canvas>
        <canvas id="lineChart3" width="900" height="400"></canvas>
        <script>
            var ctx1 = document.getElementById("lineChart1").getContext("2d");
            var lineChart1 = new Chart(ctx1, {
                type: "line",
                data: {
                    labels: {{  labels | safe }},
                    datasets: [
                        {
                            label: "Hit Rate (%)",
                            data: {{  hit_rate_val | safe }},
                            fill: false,
                            borderColor: "rgb(0, 204, 0)",
                            lineTension: 0.1
                        },
                        {
                            label: "Miss Rate (%)",
                            data: {{  miss_rate_val | safe }},
                            fill: false,
                            borderColor: "rgb(255, 0, 0)",
                            lineTension: 0.1
                        }
                    ]
                },
                options: {
                    responsive: false,
                    scales: {
                        xAxes: [{
                            display: true,
                            scaleLabel: {
                                display: true,
                                labelString: 'Timestamps'
                            }
                        }],
                        yAxes: [{
                            display: true,
                            scaleLabel: {
                                display: true,
                                labelString: 'Percentage (%)'
                            }
                        }]
                    }
                }
            });
            var ctx4 = document.getElementById("lineChart4").getContext("2d");
            var lineChart4 = new Chart(ctx4, {
                type: "line",
                data: {
                    labels: {{  labels | safe }},
                    datasets: [
                        {
                            label: "Posts Served",
                            data: {{  posts_served_val | safe }},
                            fill: false,
                            borderColor: "rgb(0, 255, 255)",
                            lineTension: 0.1
                        },
                                                {
                            label: "Gets Served",
                            data: {{  gets_served_val | safe }},
                            fill: false,
                            borderColor: "rgb(204, 0, 204)",
                            lineTension: 0.1
                        }
                    ]
                },
                options: {
                    responsive: false,
                    scales: {
                        xAxes: [{
                            display: true,
                            scaleLabel: {
                                display: true,
                                labelString: 'Timestamps'
                            }
                        }],
                        yAxes: [{
                            display: true,
                            scaleLabel: {
                                display: true,
                                labelString: 'Number of Requests'
                            }
                        }]
                    }
                }
            });
            var ctx2 = document.getElementById("lineChart2").getContext("2d");
            var lineChart2 = new Chart(ctx2, {
                type: "line",
                data: {
                    labels: {{  labels | safe }},
                    datasets: [
                        {
                            label: "Number of Items",
                            data: {{  num_items_val | safe }},
                            fill: true,
                            borderColor: "rgb(0, 0, 0)",
                            lineTension: 0.1
                        }
                    ]
                },
                options: {
                    responsive: false,
                    scales: {
                        xAxes: [{
                            display: true,
                            scaleLabel: {
                                display: true,
                                labelString: 'Timestamps'
                            }
                        }],
                        yAxes: [{
                            display: true,
                            scaleLabel: {
                                display: true,
                                labelString: 'Number'
                            }
                        }]
                    }
                }
            });
            var ctx3 = document.getElementById("lineChart3").getContext("2d");
            var lineChart3 = new Chart(ctx3, {
                type: "line",
                data: {
                    labels: {{  labels | safe }},
                    datasets: [
                        {
                            label: "Current Size (MB)",
                            data: {{  current_size_val | safe }},
                            fill: true,
                            borderColor: "rgb(0, 0, 0)",
                            lineTension: 0.1
                        }
                    ]
                },
                options: {
                    responsive: false,
                    scales: {
                        xAxes: [{
                            display: true,
                            scaleLabel: {
                                display: true,
                                labelString: 'Timestamps'
                            }
                        }],
                        yAxes: [{
                            display: true,
                            scaleLabel: {
                                display: true,
                                labelString: 'Size (MB)'
                            }
                        }]
                    }
                }
            });
        </script>
    </div>
{% endblock %}

